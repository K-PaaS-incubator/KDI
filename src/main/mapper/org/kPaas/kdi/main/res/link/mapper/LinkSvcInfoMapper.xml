<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.kPaas.kdi.main.res.link.mapper.LinkSvcInfoMapper">

	<insert id="createTable">
		CREATE TABLE `KDI_LINK_SVC_INF` (
		`SVC_ID` VARCHAR2(50) NOT NULL ,
		`DS_NM` VARCHAR2(100) NOT NULL REFERENCES KDI_DATASOURCE(DS_NM) ON DELETE CASCADE,
		`SVC_NM` VARCHAR2(100) NOT
		NULL, <!-- 서비스명화면출력용 -->
		`TP_NM` VARCHAR2(10), <!-- 토픽명 -->
		`SVC_TYPE` CHAR(1) NULL,
		`REG_ID` VARCHAR2(20) NULL,
		`REG_DT` DATE NULL,
		`MOD_ID` VARCHAR2(20) NULL,
		`MOD_DT` DATE NULL,
		PRIMARY KEY (`SVC_ID`,`DS_NM`)
		)
	</insert>

	<sql id="getLinkSvcInfListWhere">
		KDI_LINK_SVC_INF TB1
		<where>
			1=1
			<if test="param.value.svcId != null and param.value.svcId != ''">
				AND TB1.SVC_ID LIKE '%' || #{param.value.svcId} || '%'
			</if>
			<if test="param.value.dsNm != null and param.value.dsNm != ''">
				AND TB1.DS_NM LIKE '%' || #{param.value.dsNm} || '%'
			</if>
			<if test="param.value.svcNm != null and param.value.svcNm != ''">
				AND TB1.SVC_NM LIKE '%' || #{param.value.svcNm} || '%'
			</if>
			<if test="param.value.tpNm != null and param.value.tpNm != ''">
				AND TB1.TP_NM LIKE '%' || #{param.value.tpNm} || '%'
			</if>
			<if test="param.value.svcType != null and param.value.svcType != ''">
				AND TB1.SVC_TYPE LIKE '%' || #{param.value.svcType} || '%'
			</if>
			<if test="param.value.all_search != null and param.value.all_search != ''">
				OR TB1.SVC_ID LIKE '%' || #{param.value.svcId} || '%'
				OR TB1.DS_NM LIKE '%' || #{param.value.dsNm} || '%'
				OR TB1.SVC_NM LIKE '%' || #{param.value.svcNm} || '%'
				OR
				TB1.tp_NM LIKE '%' || #{param.value.tpNm} || '%'
				OR TB1.SVC_TYPE LIKE '%' || #{param.value.svcType} || '%'
			</if>
		</where>
	</sql>

	<select id="getListCnt" resultType="Long">
		SELECT
		COUNT(TB1.*)
		FROM
		<include refid="getLinkSvcInfListWhere" />
	</select>

	<select id="getList" resultType="Map">
		SELECT
		TB1.SVC_ID,
		TB1.DS_NM,
		TB1.SVC_NM,
		TB1.TP_NM,
		TB1.SVC_TYPE,
		DECODE(TB1.SVC_TYPE,'P','송신','수신') AS SVC_TYPE_NAME
		FROM
		<include refid="getLinkSvcInfListWhere" />
		ORDER BY
		TB1.SVC_NM, TB1.SVC_ID, TB1.SVC_TYPE
		LIMIT
		#{param.pagePerRow}
		OFFSET
		(#{param.pageNum} - 1) * #{param.pagePerRow}
	</select>

	<insert id="insert">
		INSERT INTO KDI_LINK_SVC_INF
		(
		SVC_ID,
		DS_NM,
		SVC_NM,
		TP_NM,
		SVC_TYPE,
		REG_ID,
		REG_DT
		) VALUES (
		#{param.value.svcId},
		#{param.value.dsNm},
		#{param.value.svcNm},
		#{param.value.tpNm},
		#{param.value.svcType},
		#{param.value.regId},
		current_timestamp()
		)
	</insert>

	<select id="duplicateCheck" resultType="Integer">
		SELECT count(*) FROM KDI_LINK_SVC_INF
		<where>SVC_ID = #{param.value.svcId}</where>
	</select>

	<select id="get" resultType="Map">
		SELECT * FROM KDI_LINK_SVC_INF
		<where>SVC_ID = #{param.value.svcId}</where>
	</select>

	<update id="modify">
		UPDATE KDI_LINK_SVC_INF
		<set>
			SVC_NM = #{param.value.svcNm},
			DS_NM = #{param.value.dsNm},
			TP_NM = #{param.value.tpNm},
			MOD_ID = #{param.value.modifyId},
			MOD_DT = current_timestamp()
		</set>
		<where>
			SVC_ID = #{param.value.svcId}
		</where>
	</update>

	<delete id="delete">
		DELETE
		FROM
		KDI_LINK_SVC_INF
		<where>
			SVC_ID = #{param.value.svcId}
		</where>
	</delete>
</mapper>