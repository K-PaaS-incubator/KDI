<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.kPaas.kdi.main.res.link.pub.mapper.LinkPubInfoMapper">

	<insert id="createTable">
		CREATE TABLE `KDI_LINK_PUB_INF` (
		`SVC_LNK_ID` VARCHAR2(100) NOT NULL,
		`SVC_ID` VARCHAR2(50) NOT NULL REFERENCES KDI_LINK_SVC_INF(SVC_ID) ON DELETE CASCADE,
		`SVC_LNK_NM`
		VARCHAR2(100) NOT NULL,
		`SCH_NM` VARCHAR2(100) NULL,
		`TBL_NM` VARCHAR2(100) NULL,
		`FLAG_TYPE` CHAR(1) NULL, <!-- 1:STATUS, 2:QUERY, 3:WHERE -->
		`FLAG_QUERY` VARCHAR2(2000) NULL, <!-- 2:QUERY, 3:WHERE 인 경우 입력받는 쿼리문 -->
		`LNK_TIME` VARCHAR2(50) NULL, <!-- 쿼츠스케줄 -->
		`REG_ID` VARCHAR2(20) NULL,
		`REG_DT` DATE NULL,
		`MOD_ID` VARCHAR2(20) NULL,
		`MOD_DT` DATE NULL,
		PRIMARY KEY (`SVC_LNK_ID`)
		)
	</insert>

	<sql id="getLinkPubInfListWhere">
		KDI_LINK_PUB_INF TB1
		JOIN
		KDI_LINK_SVC_INF TB2
		ON
		TB1.SVC_ID = TB2.SVC_ID
		<where>
			TB2.SVC_ID = #{param.value.svcId}
		</where>
	</sql>

	<select id="getListCnt" resultType="Long">
		SELECT
		COUNT(TB1.*)
		FROM
		<include refid="getLinkPubInfListWhere" />
	</select>

	<select id="getList" resultType="Map">
		SELECT
		TB1.SVC_LNK_ID,
		TB1.SVC_ID,
		TB1.SVC_LNK_NM,
		TB1.SCH_NM,
		TB1.TBL_NM,
		TB2.SVC_NM
		FROM
		<include refid="getLinkPubInfListWhere" />
		LIMIT
		#{param.pagePerRow}
		OFFSET
		(#{param.pageNum} - 1) * #{param.pagePerRow}
	</select>

	<insert id="insert">
		INSERT INTO KDI_LINK_PUB_INF (
		SVC_LNK_ID,
		SVC_ID,
		SVC_LNK_NM,
		SCH_NM,
		TBL_NM,
		FLAG_TYPE,
		FLAG_QUERY,
		LNK_TIME,
		REG_ID,
		REG_DT
		) VALUES (
		#{param.value.svcLnkId},
		#{param.value.svcId},
		#{param.value.svcLnkNm},
		#{param.value.schNm},
		#{param.value.tblNm},
		#{param.value.flagType},
		#{param.value.flagQuery},
		#{param.value.lnkTime},
		#{param.value.regId},
		current_timestamp()
		)
	</insert>

	<select id="duplicateCheck" resultType="Integer">
		SELECT count(*) FROM KDI_LINK_PUB_INF
		<where>SVC_LNK_ID = #{param.value.svcLnkId}</where>
	</select>

	<select id="get" resultType="Map">
		SELECT * FROM KDI_LINK_PUB_INF
		<where>SVC_LNK_ID = #{param.value.svcLnkId}</where>
	</select>

	<update id="modify">
		UPDATE KDI_LINK_PUB_INF
		<set>
			SVC_LNK_NM = #{param.value.svcLnkNm},
			FLAG_TYPE = #{param.value.flagType},
			FLAG_QUERY = #{param.value.flagQuery},
			LNK_TIME = #{param.value.lnkTime},
			MOD_ID =
			#{param.value.modifyId},
			MOD_DT = current_timestamp()
		</set>
		<where>
			SVC_LNK_ID = #{param.value.svcLnkId}
		</where>
	</update>

	<delete id="delete" parameterType="String">
		DELETE
		FROM
		KDI_LINK_PUB_INF
		<where>
			SVC_LNK_ID = #{param.value.svcLnkId}
		</where>
	</delete>


</mapper>